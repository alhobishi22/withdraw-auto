# دليل استخدام نظام أتمتة التحويلات مع Tasker

هذا الدليل يشرح كيفية إعداد واستخدام نظام الأتمتة للتحويلات بين بوت التلغرام وتطبيق Tasker في محاكي الأندرويد.

## المتطلبات

1. تطبيق Tasker مثبت على محاكي الأندرويد (مثل MEmu Play)
2. تطبيق المحفظة (مثل جيب، جوالي، كريمي، إلخ) مثبت على نفس المحاكي
3. خادم HTTP بسيط على المحاكي لاستقبال طلبات التحويل (يمكن استخدام تطبيق Tasker HTTP Server)

## الإعداد

### 1. إعداد Tasker

1. افتح تطبيق Tasker في محاكي الأندرويد
2. انقر على علامة التبويب "ملفات" (Profiles)
3. انقر على زر القائمة (ثلاث نقاط) واختر "استيراد" (Import)
4. اختر ملف `jaib_transfer_profile.xml` من مجلد `tasker_profiles`
5. بعد الاستيراد، تأكد من تفعيل الملف الشخصي

### 2. إعداد خادم HTTP في Tasker

1. في Tasker، انتقل إلى علامة التبويب "المزيد" (More) ثم "التفضيلات" (Preferences)
2. اختر "خادم Tasker" (Tasker Server)
3. قم بتفعيل "تشغيل خادم HTTP" (Run HTTP Server)
4. اضبط المنفذ على 8080
5. تأكد من أن عنوان URL الكامل هو `http://localhost:8080/tasker`

### 3. إعداد البوت

1. أضف المتغير البيئي التالي إلى ملف `.env`:
   ```
   TASKER_ENDPOINT=http://localhost:8080/tasker
   ```
2. قم بإعادة تشغيل البوت لتطبيق التغييرات

## كيفية عمل النظام

1. **بدء التحويل التلقائي**:
   - يمكن للمشرف بدء التحويل التلقائي من خلال الضغط على زر "تحويل تلقائي" في قائمة معالجة التحويلات
   - أو من خلال واجهة API في لوحة التحكم عبر الرابط `/api/transfers/<transfer_id>/automate`

2. **سير العملية**:
   - يرسل البوت بيانات التحويل إلى Tasker (المحفظة، الرقم، المبلغ، العملة)
   - يقوم Tasker بفتح تطبيق المحفظة وتنفيذ خطوات التحويل تلقائياً
   - بعد الانتهاء، يرسل Tasker نتيجة العملية إلى البوت
   - يقوم البوت بتحديث حالة التحويل وإعلام المستخدم والمشرف بالنتيجة

3. **خطوات التحويل في محفظة جيب**:
   - فتح التطبيق
   - إدخال كلمة المرور
   - الضغط على خيار "تحويلات مالية"
   - اختيار "التحويل إلى مشترك"
   - اختيار العملة
   - إدخال المبلغ
   - إدخال رقم الموبايل
   - الضغط على زر "استمرار"
   - تأكيد التحويل

## تخصيص الإعدادات

### تعديل كلمة المرور

في ملف `jaib_transfer_profile.xml`، قم بتعديل القيم التالية:
- البحث عن `<Str sr="arg2" val="1234"/>` وتغيير "1234" إلى كلمة المرور الخاصة بك

### إضافة دعم لمحافظ أخرى

1. قم بنسخ ملف `jaib_transfer_profile.xml` وإعادة تسميته (مثلاً `jawali_transfer_profile.xml`)
2. قم بتعديل الخطوات حسب واجهة المحفظة المطلوبة
3. قم باستيراد الملف الجديد إلى Tasker

## استكشاف الأخطاء وإصلاحها

1. **التحويل لا يبدأ**:
   - تأكد من أن خادم HTTP في Tasker يعمل
   - تحقق من صحة عنوان TASKER_ENDPOINT في ملف `.env`
   - تحقق من سجلات البوت للأخطاء

2. **فشل التحويل**:
   - تأكد من أن المحاكي يعمل وأن التطبيق مفتوح
   - تحقق من صحة بيانات التحويل (الرقم، المبلغ، العملة)
   - تأكد من وجود رصيد كافٍ في المحفظة

3. **لا يتم إرسال النتيجة إلى البوت**:
   - تأكد من أن عنوان الاستدعاء العكسي صحيح في ملف Tasker
   - تحقق من اتصال المحاكي بالإنترنت

## ملاحظات هامة

- تأكد من تأمين المحاكي وعدم وصول أي شخص غير مصرح له إليه
- قم بتغيير كلمات المرور بانتظام
- قم بمراقبة سجلات النظام بانتظام للتأكد من سلامة العمليات
- يُفضل استخدام هذا النظام في بيئة آمنة ومحمية
